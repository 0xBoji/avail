name: Polygon Avail Releaser
on: push

jobs:
  release_centos7_amd64:
    runs-on: ubuntu-latest
    container:
      image: amd64/centos:centos7
    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    steps:
         - uses: actions/checkout@v2
         - name: install cargo deps and build avail
           run: |
            cat /etc/os-release
            yum install git -y
            yum install centos-release-scl -y
            yum install llvm-toolset-7 -y
            yum install gcc-c++ -y
            scl enable llvm-toolset-7 bash
            export PATH="/opt/rh/llvm-toolset-7/root/usr/bin:$PATH"
            export LIBCLANG_PATH="/opt/rh/llvm-toolset-7/root/usr/lib64/"
            curl https://sh.rustup.rs -sSf | sh -s -- -y
            source "$HOME/.cargo/env"
            cargo build --release -p data-avail
            cd target/release
            ls -a
            yum install awscli -y
            aws s3 cp data-avail s3://avail-binaries/data-avail-git
  release_darwin:
    runs-on: macos-latest
    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    steps:
         - uses: actions/checkout@v2
         - name: install cargo deps and build avail
           run: |
            uname -m


# add docker buildx

# add binary builds for all other arch
